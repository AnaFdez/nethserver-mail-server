#
# Namespace setup
#

# Private mailboxes
namespace \{
  type = private
  separator = /
  prefix = 
  # location defaults to mail_location.
  inbox = yes
\}

# Shared mailboxes are { $dovecot{SharedMailboxesStatus} }
{
    if($dovecot{SharedMailboxesStatus} ne 'enabled') {
        return '';
    }

    return <<NAMESPACE;
namespace {
  type = shared
  separator = /
  prefix = Shared/%%n/
  location = maildir:/var/lib/vmail/private/%%n/Maildir:INDEX=~/Maildir/shared/%%n
  subscriptions = no
  list = children
}

# Enable acl plugin for shared and/or public mailboxes
mail_plugins = \$mail_plugins acl
protocol imap {
  mail_plugins = \$mail_plugins imap_acl
}

plugin {
  acl = vfile
  acl_shared_dict = file:/var/lib/vmail/shared-mailboxes.db
}

service dict {
  unix_listener dict {
    mode = 0600
    user = vmail
  }
}
NAMESPACE
}
