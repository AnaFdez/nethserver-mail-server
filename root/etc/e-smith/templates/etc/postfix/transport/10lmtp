#
# Domain-specific delivery table
#
{
    use esmith::DomainsDB;

    my $domainsDb = esmith::DomainsDB->open_ro();

    my $transport = '';

    $OUT = '';

    foreach my $domainRecord ($domainsDb->get_all_by_prop(type => 'domain')) {
	my $deliveryType = $domainRecord->prop('TransportType');
	if($deliveryType eq 'LocalDelivery') {
	    $transport = 'lmtp:unix:/var/run/dovecot/lmtp';
	} elsif($deliveryType eq 'RemoteDelivery') {
	    $transport = join(':', 
			      $domainRecord->prop('RemoteDeliveryProtocol'),
			      '[' . $domainRecord->prop('RemoteDeliveryHost') . ']',
			      $domainRecord->prop('RemoteDeliveryPort')
		);
	} else {
	    # Skip unknown delivery type
	    next;
	}

	$OUT .= $domainRecord->key . "\t" . $transport . "\n";
    }

    return $OUT;
}
